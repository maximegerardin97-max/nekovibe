<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nekovibe</title>
    <link rel="stylesheet" href="./styles.css" />
    <link rel="preconnect" href="https://rsms.me/" />
  </head>
  <body
    data-function-url="https://cqlopsqqqzzkfpmcntbv.supabase.co/functions/v1/nekovibe-chat"
    data-apikey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNxbG9wc3FxcXp6a2ZwbWNudGJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMjUxNDMsImV4cCI6MjA3ODcwMTE0M30.J3vuzmF7cG3e6ZMx_NwHtmTIqQKJvKP1cGOXcoXBaX0"
    data-supabase-url="https://cqlopsqqqzzkfpmcntbv.supabase.co"
  >
    <div class="app-shell">
      <header class="app-header">
        <div>
          <p class="eyebrow">nekovibe</p>
          <h1>Ask anything about Neko Health</h1>
          <p class="subtitle">
            Powered by real customer reviews. Choose your sources and let the assistant surface the insights.
          </p>
        </div>
        <div class="source-switcher" role="group" aria-label="Knowledge sources">
          <button id="tab-chat" class="source-pill-button tab-button active" type="button">
            Chat
          </button>
          <button id="tab-reviews" class="source-pill-button tab-button" type="button">
            Neko reviews
          </button>
          <label class="source-pill">
            <input type="checkbox" value="articles" name="sources" />
            <span>Articles / Press</span>
          </label>
          <label class="source-pill disabled">
            <input type="checkbox" value="social" name="sources" disabled />
            <span>Social</span>
          </label>
        </div>
      </header>

      <main>
        <!-- Chat View -->
        <div id="chat-view" class="tab-content active">
          <section id="chat-stream" aria-live="polite">
            <div class="empty-state">
              <p>Try "What do patients say about the Covent Garden clinic?"</p>
              <p>or "Summarize top concerns from the last 30 days".</p>
            </div>
          </section>

          <form id="ask-form">
            <div class="input-wrapper">
              <textarea
                name="prompt"
                id="prompt"
                rows="3"
                placeholder="Ask anything…"
                autocomplete="off"
              ></textarea>
              <button type="submit" aria-label="Send">
                <span>Send</span>
              </button>
            </div>
          </form>
        </div>

        <!-- Neko Reviews View (Combined Reviews + Chat) -->
        <div id="reviews-view" class="tab-content">
          <div class="reviews-combined-layout">
            <!-- Top: Chat -->
            <div class="reviews-chat-section">
              <section id="reviews-chat-stream" aria-live="polite">
                <div class="empty-state">
                  <p>What do you want to know about the reviews?</p>
                </div>
              </section>

              <form id="reviews-ask-form">
                <div class="input-wrapper">
                  <textarea
                    name="reviews-prompt"
                    id="reviews-prompt"
                    rows="3"
                    placeholder="Ask anything about the reviews…"
                    autocomplete="off"
                  ></textarea>
                  <button type="submit" aria-label="Send">
                    <span>Send</span>
                  </button>
                </div>
              </form>
            </div>

            <!-- Bottom: Reviews Table with Filters -->
            <div class="reviews-container">
              <!-- Filters -->
              <div class="reviews-filters">
                <div class="filter-group">
                  <label for="filter-clinic">Clinic</label>
                  <select id="filter-clinic">
                    <option value="">All Clinics</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="filter-rating">Rating</label>
                  <select id="filter-rating">
                    <option value="">All Ratings</option>
                    <option value="5">5 Stars</option>
                    <option value="4">4 Stars</option>
                    <option value="3">3 Stars</option>
                    <option value="2">2 Stars</option>
                    <option value="1">1 Star</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="filter-date-from">Date From</label>
                  <input type="date" id="filter-date-from" />
                </div>
                <div class="filter-group">
                  <label for="filter-date-to">Date To</label>
                  <input type="date" id="filter-date-to" />
                </div>
                <div class="filter-group filter-group-wide">
                  <label for="filter-comment">Search Comment</label>
                  <input type="text" id="filter-comment" placeholder="Search in review text..." />
                </div>
                <div class="filter-actions">
                  <button id="apply-filters" class="filter-btn">Apply Filters</button>
                  <button id="clear-filters" class="filter-btn filter-btn-secondary">Clear</button>
                </div>
              </div>

              <!-- Results Info -->
              <div class="reviews-info">
                <span id="reviews-count">Loading reviews...</span>
              </div>

              <!-- Reviews Table -->
              <div class="reviews-table-container">
                <table class="reviews-table">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Rating</th>
                      <th>Clinic</th>
                      <th>Comment</th>
                    </tr>
                  </thead>
                  <tbody id="reviews-tbody">
                    <tr>
                      <td colspan="4" class="loading-state">Loading reviews...</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Pagination -->
              <div class="reviews-pagination">
                <button id="prev-page" class="pagination-btn" disabled>Previous</button>
                <span id="page-info">Page 1</span>
                <button id="next-page" class="pagination-btn">Next</button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>

