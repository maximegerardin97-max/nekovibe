<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nekovibe</title>
    <link rel="stylesheet" href="./styles.css" />
    <link rel="preconnect" href="https://rsms.me/" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  </head>
  <body
    data-function-url="https://cqlopsqqqzzkfpmcntbv.supabase.co/functions/v1/nekovibe-chat"
    data-apikey="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNxbG9wc3FxcXp6a2ZwbWNudGJ2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjMxMjUxNDMsImV4cCI6MjA3ODcwMTE0M30.J3vuzmF7cG3e6ZMx_NwHtmTIqQKJvKP1cGOXcoXBaX0"
    data-supabase-url="https://cqlopsqqqzzkfpmcntbv.supabase.co"
  >
    <div class="app-shell">
      <header class="app-header">
        <div>
          <p class="eyebrow">nekovibe</p>
          <h1>Ask anything about Neko Health</h1>
          <p class="subtitle">
            Powered by real customer reviews. Choose your sources and let the assistant surface the insights.
          </p>
        </div>
        <div class="source-switcher" role="group" aria-label="Knowledge sources">
          <button id="tab-internal" class="source-pill-button tab-button active" type="button">
            ðŸ”’ Internal Reviews
          </button>
          <button id="tab-reviews" class="source-pill-button tab-button" type="button">
            Neko Google Reviews
          </button>
          <button id="tab-articles" class="source-pill-button tab-button" type="button">
            Articles / Press / LinkedIn
          </button>
          <button id="tab-chat" class="source-pill-button tab-button" type="button">
            Neko chat
          </button>
        </div>
      </header>

      <main>
        <!-- Neko Chat View (General) -->
        <div id="chat-view" class="tab-content">
          <section id="chat-stream" aria-live="polite">
            <div class="empty-state">
              <p>Ask anything about Neko Health</p>
            </div>
          </section>

          <form id="ask-form">
            <div class="input-wrapper">
              <textarea
                name="prompt"
                id="prompt"
                rows="3"
                placeholder="Ask anything about Neko Healthâ€¦"
                autocomplete="off"
              ></textarea>
              <button type="submit" aria-label="Send">
                <span>Send</span>
              </button>
            </div>
          </form>
        </div>

        <!-- Neko Reviews View (Combined Reviews + Chat) -->
        <div id="reviews-view" class="tab-content">
          <div class="reviews-combined-layout">
            <!-- Top: Chat -->
            <div class="reviews-chat-section">
              <section id="reviews-chat-stream" aria-live="polite">
                <div class="empty-state">
                  <p>What do you want to know about the reviews?</p>
                </div>
              </section>

          <div class="chat-filters">
            <div class="filter-group">
              <label for="reviews-chat-clinic-filter">Clinic</label>
              <select id="reviews-chat-clinic-filter">
                <option value="">All Clinics</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="reviews-chat-date-from">Date From</label>
              <input type="date" id="reviews-chat-date-from" />
            </div>
            <div class="filter-group">
              <label for="reviews-chat-date-to">Date To</label>
              <input type="date" id="reviews-chat-date-to" />
            </div>
            <div class="filter-actions">
              <button type="button" id="reviews-chat-clear-filters" class="filter-btn filter-btn-secondary">
                Clear Filters
              </button>
            </div>
          </div>

              <form id="reviews-ask-form">
                <div class="input-wrapper">
                  <textarea
                    name="reviews-prompt"
                    id="reviews-prompt"
                    rows="1"
                    placeholder="Ask anything about Neko Health..."
                    autocomplete="off"
                  ></textarea>
                  <button type="submit" aria-label="Send">
                    <span>Send</span>
                  </button>
                </div>
              </form>
            </div>

            <!-- Ratings Graph -->
            <div class="ratings-graph-container">
              <div class="graph-header">
                <h3>Ratings Over Time</h3>
                <div class="graph-filter">
                  <label for="graph-clinic-filter">Clinic:</label>
                  <select id="graph-clinic-filter">
                    <option value="">All Clinics</option>
                  </select>
                </div>
              </div>
              <canvas id="ratings-chart"></canvas>
            </div>

            <!-- Bottom: Reviews Table with Filters -->
            <div class="reviews-container">
              <!-- Filters -->
              <div class="reviews-filters">
                <div class="filter-group">
                  <label for="filter-clinic">Clinic</label>
                  <select id="filter-clinic">
                    <option value="">All Clinics</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="filter-rating">Rating</label>
                  <select id="filter-rating">
                    <option value="">All Ratings</option>
                    <option value="5">5 Stars</option>
                    <option value="4">4 Stars</option>
                    <option value="3">3 Stars</option>
                    <option value="2">2 Stars</option>
                    <option value="1">1 Star</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="filter-date-from">Date From</label>
                  <input type="date" id="filter-date-from" />
                </div>
                <div class="filter-group">
                  <label for="filter-date-to">Date To</label>
                  <input type="date" id="filter-date-to" />
                </div>
                <div class="filter-group filter-group-wide">
                  <label for="filter-comment">Search Comment</label>
                  <input type="text" id="filter-comment" placeholder="Search in review text..." />
                </div>
                <div class="filter-actions">
                  <button id="apply-filters" class="filter-btn">Apply Filters</button>
                  <button id="clear-filters" class="filter-btn filter-btn-secondary">Clear</button>
                </div>
              </div>

              <!-- Results Info -->
              <div class="reviews-info">
                <span id="reviews-count">Loading reviews...</span>
              </div>

              <!-- Reviews Table -->
              <div class="reviews-table-container">
                <table class="reviews-table">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Rating</th>
                      <th>Clinic</th>
                      <th>Comment</th>
                    </tr>
                  </thead>
                  <tbody id="reviews-tbody">
                    <tr>
                      <td colspan="4" class="loading-state">Loading reviews...</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Pagination -->
              <div class="reviews-pagination">
                <button id="prev-page" class="pagination-btn" disabled>Previous</button>
                <span id="page-info">Page 1</span>
                <button id="next-page" class="pagination-btn">Next</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Articles / Press / LinkedIn View (Combined Articles + Chat) -->
        <div id="articles-view" class="tab-content">
          <div class="reviews-combined-layout">
            <!-- Top: Chat -->
            <div class="reviews-chat-section">
              <section id="articles-chat-stream" aria-live="polite">
                <div class="empty-state">
                  <p>What do you want to know about articles, press, and LinkedIn?</p>
                </div>
              </section>

              <form id="articles-ask-form">
                <div class="input-wrapper">
                  <textarea
                    name="articles-prompt"
                    id="articles-prompt"
                    rows="3"
                    placeholder="Ask anything about articles and pressâ€¦"
                    autocomplete="off"
                  ></textarea>
                  <button type="submit" aria-label="Send">
                    <span>Send</span>
                  </button>
                </div>
              </form>
            </div>

            <!-- Bottom: Articles Table with Filters -->
            <div class="reviews-container">
              <!-- Filters -->
              <div class="reviews-filters">
                <div class="filter-group">
                  <label for="filter-article-source">Source</label>
                  <select id="filter-article-source">
                    <option value="">All Sources</option>
                    <option value="blog">Blog</option>
                    <option value="press">Press</option>
                    <option value="article">Article</option>
                    <option value="linkedin">LinkedIn</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="filter-article-date-from">Date From</label>
                  <input type="date" id="filter-article-date-from" />
                </div>
                <div class="filter-group">
                  <label for="filter-article-date-to">Date To</label>
                  <input type="date" id="filter-article-date-to" />
                </div>
                <div class="filter-group filter-group-wide">
                  <label for="filter-article-text">Search Title/Content</label>
                  <input type="text" id="filter-article-text" placeholder="Search in title or content..." />
                </div>
                <div class="filter-actions">
                  <button id="apply-article-filters" class="filter-btn">Apply Filters</button>
                  <button id="clear-article-filters" class="filter-btn filter-btn-secondary">Clear</button>
                </div>
              </div>

              <!-- Results Info -->
              <div class="reviews-info">
                <span id="articles-count">Loading articles...</span>
              </div>

              <!-- Articles Table -->
              <div class="reviews-table-container">
                <table class="reviews-table">
                  <thead>
                    <tr>
                      <th>Date</th>
                      <th>Source</th>
                      <th>Title</th>
                      <th>Author</th>
                      <th>Summary</th>
                    </tr>
                  </thead>
                  <tbody id="articles-tbody">
                    <tr>
                      <td colspan="4" class="loading-state">Loading articles...</td>
                    </tr>
                  </tbody>
                </table>
              </div>

              <!-- Pagination -->
              <div class="reviews-pagination">
                <button id="prev-article-page" class="pagination-btn" disabled>Previous</button>
                <span id="article-page-info">Page 1</span>
                <button id="next-article-page" class="pagination-btn">Next</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Internal Reviews View (Password Protected) - DEFAULT -->
        <div id="internal-view" class="tab-content active">
          <div id="internal-login" class="internal-login-container">
            <div class="login-box">
              <h2>Internal Reviews</h2>
              <p>This section is password protected</p>
              <form id="internal-login-form">
                <input type="password" id="internal-password" placeholder="Enter password" autocomplete="off" />
                <button type="submit">Access</button>
              </form>
              <p id="internal-login-error" class="error-message" style="display: none;"></p>
            </div>
          </div>

          <div id="internal-content" style="display: none;">
            <div class="reviews-combined-layout">
              <!-- Top: Chat -->
              <div class="reviews-chat-section">
                <section id="internal-chat-stream" aria-live="polite">
                  <div class="empty-state">
                    <p>Ask anything about the internal reviews</p>
                  </div>
                </section>

                <div class="chat-filters">
                  <div class="filter-group">
                    <label for="internal-chat-clinic-filter">Clinic</label>
                    <select id="internal-chat-clinic-filter">
                      <option value="">All Clinics</option>
                    </select>
                  </div>
                  <div class="filter-group">
                    <label for="internal-chat-date-from">Date From</label>
                    <input type="date" id="internal-chat-date-from" />
                  </div>
                  <div class="filter-group">
                    <label for="internal-chat-date-to">Date To</label>
                    <input type="date" id="internal-chat-date-to" />
                  </div>
                  <div class="filter-actions">
                    <button type="button" id="internal-chat-clear-filters" class="filter-btn filter-btn-secondary">
                      Clear Filters
                    </button>
                  </div>
                </div>

                <form id="internal-ask-form">
                  <div class="input-wrapper">
                    <textarea
                      name="internal-prompt"
                      id="internal-prompt"
                      rows="1"
                      placeholder="Ask anything about Neko Health..."
                      autocomplete="off"
                    ></textarea>
                    <button type="submit" aria-label="Send">
                      <span>Send</span>
                    </button>
                  </div>
                  <div class="chat-actions">
                    <button type="button" id="analyze-all-btn" class="analyze-btn">
                      Analyze All Reviews
                    </button>
                  </div>
                </form>
              </div>

              <!-- CSV Upload -->
              <div class="csv-upload-container">
                <h3>Upload Reviews CSV</h3>
                <form id="csv-upload-form">
                  <input type="file" id="csv-file-input" accept=".csv" required />
                  <button type="submit">Upload CSV</button>
                </form>
                <div id="upload-status"></div>
              </div>

              <!-- Ratings Graph -->
              <div class="ratings-graph-container">
                <div class="graph-header">
                  <h3>Ratings Over Time</h3>
                  <div class="graph-filter">
                    <label for="internal-graph-clinic-filter">Clinic:</label>
                    <select id="internal-graph-clinic-filter">
                      <option value="">All Clinics</option>
                    </select>
                  </div>
                </div>
                <canvas id="internal-ratings-chart"></canvas>
              </div>

              <!-- Bottom: Reviews Table with Filters -->
              <div class="reviews-container">
                <!-- Filters -->
                <div class="reviews-filters">
                  <div class="filter-group">
                    <label for="internal-filter-clinic">Clinic</label>
                    <select id="internal-filter-clinic">
                      <option value="">All Clinics</option>
                    </select>
                  </div>
                  <div class="filter-group">
                    <label for="internal-filter-rating">Rating</label>
                    <select id="internal-filter-rating">
                      <option value="">All Ratings</option>
                      <option value="5">5 Stars</option>
                      <option value="4">4 Stars</option>
                      <option value="3">3 Stars</option>
                      <option value="2">2 Stars</option>
                      <option value="1">1 Star</option>
                    </select>
                  </div>
                  <div class="filter-group">
                    <label for="internal-filter-date-from">Date From</label>
                    <input type="date" id="internal-filter-date-from" />
                  </div>
                  <div class="filter-group">
                    <label for="internal-filter-date-to">Date To</label>
                    <input type="date" id="internal-filter-date-to" />
                  </div>
                  <div class="filter-group filter-group-wide">
                    <label for="internal-filter-comment">Search Comment</label>
                    <input type="text" id="internal-filter-comment" placeholder="Search in comments..." />
                  </div>
                  <div class="filter-actions">
                    <button id="apply-internal-filters" class="filter-btn">Apply Filters</button>
                    <button id="clear-internal-filters" class="filter-btn filter-btn-secondary">Clear</button>
                  </div>
                </div>

                <!-- Results Info -->
                <div class="reviews-info">
                  <span id="internal-reviews-count">Loading reviews...</span>
                </div>

                <!-- Reviews Table -->
                <div class="reviews-table-container">
                  <table class="reviews-table">
                    <thead>
                      <tr>
                        <th>Date</th>
                        <th>Rating</th>
                        <th>Clinic</th>
                        <th>Comment</th>
                      </tr>
                    </thead>
                    <tbody id="internal-reviews-tbody">
                      <tr>
                        <td colspan="4" class="loading-state">Loading reviews...</td>
                      </tr>
                    </tbody>
                  </table>
                </div>

                <!-- Pagination -->
                <div class="reviews-pagination">
                  <button id="prev-internal-page" class="pagination-btn" disabled>Previous</button>
                  <span id="internal-page-info">Page 1</span>
                  <button id="next-internal-page" class="pagination-btn">Next</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="./app.js"></script>
    <script type="module" src="./internal-reviews.js"></script>
  </body>
</html>

